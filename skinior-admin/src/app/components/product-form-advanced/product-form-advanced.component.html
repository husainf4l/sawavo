<div class="product-form-container">
  <!-- Header -->
  <mat-card class="header-card">
    <mat-card-content>
      <div class="header-content">
        <div class="title-section">
          <button mat-icon-button (click)="goBack()" class="back-button">
            <mat-icon>arrow_back</mat-icon>
          </button>
          <div>
            <h1 class="page-title">
              <mat-icon>{{ isEditMode ? 'edit' : 'add' }}</mat-icon>
              {{ isEditMode ? 'Edit Product' : 'Add New Product' }}
            </h1>
            <p class="page-subtitle">{{ isEditMode ? 'Update product information' : 'Create a comprehensive product listing' }}</p>
          </div>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Form -->
  <form [formGroup]="productForm" (ngSubmit)="onSubmit()">
    <mat-tab-group class="form-tabs" [(selectedIndex)]="selectedTabIndex">
      
      <!-- Basic Information Tab -->
      <mat-tab label="Basic Info">
        <div class="tab-content">
          <mat-card class="form-section">
            <mat-card-header>
              <mat-card-title>
                <mat-icon>info</mat-icon>
                Product Details
              </mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="form-row">
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>Product Title *</mat-label>
                  <input matInput formControlName="title" placeholder="Enter product title">
                  <mat-error *ngIf="productForm.get('title')?.hasError('required')">
                    Product title is required
                  </mat-error>
                </mat-form-field>
              </div>

              <div class="form-row">
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>Product Title (Arabic)</mat-label>
                  <input matInput formControlName="titleAr" placeholder="أدخل عنوان المنتج">
                </mat-form-field>
              </div>

              <div class="form-row">
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>URL Slug</mat-label>
                  <input matInput formControlName="slug" placeholder="product-url-slug">
                  <mat-hint>Auto-generated from title if left empty</mat-hint>
                </mat-form-field>
              </div>

              <div class="form-row two-columns">
                <mat-form-field appearance="outline">
                  <mat-label>SKU</mat-label>
                  <input matInput formControlName="sku" placeholder="PROD-001">
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label>Category</mat-label>
                  <mat-select formControlName="categoryId">
                    <mat-option value="face-care">Face Care</mat-option>
                    <mat-option value="body-care">Body Care</mat-option>
                    <mat-option value="hair-care">Hair Care</mat-option>
                    <mat-option value="sun-care">Sun Care</mat-option>
                    <mat-option value="makeup">Makeup</mat-option>
                    <mat-option value="fragrance">Fragrance</mat-option>
                    <mat-option value="supplements">Supplements</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>

              <div class="form-row">
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>Description (English) *</mat-label>
                  <textarea matInput formControlName="descriptionEn" rows="4" placeholder="Detailed product description"></textarea>
                  <mat-error *ngIf="productForm.get('descriptionEn')?.hasError('required')">
                    Description is required
                  </mat-error>
                </mat-form-field>
              </div>

              <div class="form-row">
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>Description (Arabic)</mat-label>
                  <textarea matInput formControlName="descriptionAr" rows="4" placeholder="وصف تفصيلي للمنتج"></textarea>
                </mat-form-field>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </mat-tab>

      <!-- Pricing & Inventory Tab -->
      <mat-tab label="Pricing & Stock">
        <div class="tab-content">
          <mat-card class="form-section">
            <mat-card-header>
              <mat-card-title>
                <mat-icon>attach_money</mat-icon>
                Pricing Information
              </mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="form-row two-columns">
                <mat-form-field appearance="outline">
                  <mat-label>Price *</mat-label>
                  <input matInput type="number" formControlName="price" placeholder="0.00" step="0.01" min="0">
                  <span matPrefix>$&nbsp;</span>
                  <mat-error *ngIf="productForm.get('price')?.hasError('required')">Price is required</mat-error>
                  <mat-error *ngIf="productForm.get('price')?.hasError('min')">Price must be greater than 0</mat-error>
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label>Compare At Price</mat-label>
                  <input matInput type="number" formControlName="compareAtPrice" placeholder="0.00" step="0.01" min="0">
                  <span matPrefix>$&nbsp;</span>
                  <mat-hint>Original price for showing discounts</mat-hint>
                </mat-form-field>
              </div>

              <div class="form-row two-columns">
                <mat-form-field appearance="outline">
                  <mat-label>Currency</mat-label>
                  <mat-select formControlName="currency">
                    <mat-option value="USD">USD</mat-option>
                    <mat-option value="EUR">EUR</mat-option>
                    <mat-option value="SAR">SAR</mat-option>
                    <mat-option value="AED">AED</mat-option>
                  </mat-select>
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label>Stock Quantity</mat-label>
                  <input matInput type="number" formControlName="stockQuantity" placeholder="0" min="0">
                </mat-form-field>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </mat-tab>

      <!-- Skincare Details Tab -->
      <mat-tab label="Skincare Info">
        <div class="tab-content">
          <mat-card class="form-section">
            <mat-card-header>
              <mat-card-title>
                <mat-icon>face</mat-icon>
                Skincare Specifications
              </mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="form-row">
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>Active Ingredients</mat-label>
                  <textarea matInput formControlName="activeIngredients" rows="3" placeholder="List the key active ingredients"></textarea>
                </mat-form-field>
              </div>

              <div class="form-row two-columns">
                <mat-form-field appearance="outline">
                  <mat-label>Skin Type</mat-label>
                  <mat-select formControlName="skinType">
                    <mat-option value="all">All Skin Types</mat-option>
                    <mat-option value="dry">Dry</mat-option>
                    <mat-option value="oily">Oily</mat-option>
                    <mat-option value="combination">Combination</mat-option>
                    <mat-option value="sensitive">Sensitive</mat-option>
                    <mat-option value="normal">Normal</mat-option>
                    <mat-option value="acne-prone">Acne-Prone</mat-option>
                    <mat-option value="mature">Mature</mat-option>
                  </mat-select>
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label>Usage Frequency</mat-label>
                  <mat-select formControlName="usage">
                    <mat-option value="daily-am">Daily (Morning)</mat-option>
                    <mat-option value="daily-pm">Daily (Evening)</mat-option>
                    <mat-option value="daily-both">Daily (AM & PM)</mat-option>
                    <mat-option value="weekly">Weekly</mat-option>
                    <mat-option value="as-needed">As Needed</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>

              <!-- Dynamic Arrays -->
              <div class="form-row">
                <div class="array-field">
                  <h4>Skin Concerns</h4>
                  <div formArrayName="concerns">
                    <div *ngFor="let concern of concerns.controls; let i = index" class="array-item">
                      <mat-form-field appearance="outline">
                        <input matInput [formControlName]="i" placeholder="e.g., Acne, Wrinkles, Dark Spots">
                      </mat-form-field>
                      <button type="button" mat-icon-button color="warn" (click)="removeConcern(i)">
                        <mat-icon>remove</mat-icon>
                      </button>
                    </div>
                  </div>
                  <button type="button" mat-stroked-button (click)="addConcern()">
                    <mat-icon>add</mat-icon>
                    Add Concern
                  </button>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </mat-tab>

      <!-- Images Tab -->
      <mat-tab label="Images">
        <div class="tab-content">
          <mat-card class="form-section">
            <mat-card-header>
              <mat-card-title>
                <mat-icon>photo_library</mat-icon>
                Product Images
              </mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div formArrayName="images">
                <div *ngFor="let image of images.controls; let i = index" [formGroupName]="i" class="image-form">
                  <div class="image-row">
                    <mat-form-field appearance="outline" class="image-url-field">
                      <mat-label>Image URL</mat-label>
                      <input matInput formControlName="url" placeholder="https://example.com/image.jpg">
                    </mat-form-field>
                    
                    <mat-form-field appearance="outline" class="alt-text-field">
                      <mat-label>Alt Text</mat-label>
                      <input matInput formControlName="altText" placeholder="Descriptive text">
                    </mat-form-field>

                    <div class="image-options">
                      <mat-slide-toggle formControlName="isMain" color="primary">Main</mat-slide-toggle>
                      <mat-slide-toggle formControlName="isHover" color="accent">Hover</mat-slide-toggle>
                    </div>

                    <button type="button" mat-icon-button color="warn" (click)="removeImage(i)">
                      <mat-icon>delete</mat-icon>
                    </button>
                  </div>

                  <div class="image-preview" *ngIf="image.get('url')?.value">
                    <img [src]="image.get('url')?.value" [alt]="image.get('altText')?.value" (error)="onImageError($event)">
                  </div>
                </div>
              </div>

              <button type="button" mat-raised-button color="primary" (click)="addImage()">
                <mat-icon>add_photo_alternate</mat-icon>
                Add Image
              </button>
            </mat-card-content>
          </mat-card>
        </div>
      </mat-tab>

      <!-- Settings Tab -->
      <mat-tab label="Settings">
        <div class="tab-content">
          <mat-card class="form-section">
            <mat-card-header>
              <mat-card-title>
                <mat-icon>settings</mat-icon>
                Product Settings
              </mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="form-row">
                <div class="toggle-group">
                  <mat-slide-toggle formControlName="isActive" color="primary">
                    <span class="toggle-label">
                      <mat-icon>visibility</mat-icon>
                      Active Product
                    </span>
                  </mat-slide-toggle>
                  <p class="toggle-description">Product will be visible on the website</p>
                </div>
              </div>

              <div class="form-row">
                <div class="toggle-group">
                  <mat-slide-toggle formControlName="isFeatured" color="primary">
                    <span class="toggle-label">
                      <mat-icon>star</mat-icon>
                      Featured Product
                    </span>
                  </mat-slide-toggle>
                  <p class="toggle-description">Product will appear in featured sections</p>
                </div>
              </div>

              <div class="form-row">
                <div class="toggle-group">
                  <mat-slide-toggle formControlName="isNew" color="accent">
                    <span class="toggle-label">
                      <mat-icon>fiber_new</mat-icon>
                      New Product
                    </span>
                  </mat-slide-toggle>
                  <p class="toggle-description">Product will be marked as new</p>
                </div>
              </div>
            </mat-card-content>
          </mat-card>

          <!-- SEO Section -->
          <mat-card class="form-section">
            <mat-card-header>
              <mat-card-title>
                <mat-icon>search</mat-icon>
                SEO Settings
              </mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="form-row">
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>Meta Title</mat-label>
                  <input matInput formControlName="metaTitle" placeholder="SEO optimized title">
                  <mat-hint>Recommended: 50-60 characters</mat-hint>
                </mat-form-field>
              </div>

              <div class="form-row">
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>Meta Description</mat-label>
                  <textarea matInput formControlName="metaDescription" rows="3" placeholder="Brief description for search engines"></textarea>
                  <mat-hint>Recommended: 150-160 characters</mat-hint>
                </mat-form-field>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </mat-tab>
    </mat-tab-group>

    <!-- Action Buttons -->
    <mat-card class="actions-section">
      <mat-card-content>
        <div class="form-actions">
          <button type="button" mat-stroked-button color="primary" (click)="goBack()" class="action-button">
            <mat-icon>close</mat-icon>
            Cancel
          </button>
          
          <button type="button" mat-stroked-button color="accent" (click)="resetForm()" class="action-button" *ngIf="!isEditMode">
            <mat-icon>refresh</mat-icon>
            Reset
          </button>

          <button type="submit" mat-raised-button color="primary" [disabled]="productForm.invalid || saving" class="action-button primary">
            <mat-icon *ngIf="!saving">{{ isEditMode ? 'save' : 'add' }}</mat-icon>
            <mat-icon *ngIf="saving" class="spinning">refresh</mat-icon>
            {{ saving ? 'Saving...' : (isEditMode ? 'Update Product' : 'Create Product') }}
          </button>
        </div>
      </mat-card-content>
    </mat-card>
  </form>
</div>
